{% extends "layout.html" %}
{% block content %}

<!-- Fun Rules of Betting -->
<div class="card mb-4 border-primary shadow-sm">
    <div class="card-header bg-primary text-white fw-bold">
        📜 Rules of Betting – Read Before You Wager!
    </div>
    <div class="card-body">
        <ol>
            <li><strong>It's All for Fun 🎉</strong> – Just for friends and entertainment.</li>
            <li><strong>Start With 1000 Credits 💰</strong> – Use wisely.</li>
            <li><strong>Check the Odds 🎲</strong> – Higher odds = bigger payouts.</li>
            <li><strong>Unlimited Outcomes 🔄</strong> – Choose wisely.</li>
            <li><strong>Bet Responsibly 🎯</strong> – Avoid one crazy hunch unless you like drama.</li>
            <li><strong>Pending Bets ⏳</strong> – Resolved by admin.</li>
            <li><strong>Winnings 🚀</strong> – Stake × odds added to your balance.</li>
            <li><strong>Respect the Admin 👑</strong> – Final decisions.</li>
            <li><strong>Have Fun! 🎊</strong> – Bet smart and laugh loud!</li>
        </ol>
        <p class="text-muted"><em>Disclaimer: All betting here is fictional – no actual money changes hands.</em></p>
    </div>
</div>

<h1 class="mb-2">🏆 Who's Gonna Win? <small class="text-muted">Place your bets now!</small></h1>
<p class="fs-5 fst-italic text-primary slogan">{{ slogan }}</p>

<!-- Approved Events -->
<h2 class="mt-4">✅ Active Events</h2>
{% if events_data %}
    {% for e in events_data %}
      <div class="card mb-3">
        <div class="card-body">
          <h5>{{ e.event.title }}</h5>
          <form method="POST" action="{{ url_for('place_bet', event_id=e.event.id) }}" class="row g-2">
              <div class="col-md-4">
                  <select name="outcome_id" class="form-select">
                      {% for o in e.outcomes %}
                          <option value="{{o.id}}">{{o.outcome_name}} @ {{o.odds}}</option>
                      {% endfor %}
                  </select>
              </div>
              <div class="col-md-3">
                  <input type="number" name="amount" class="form-control" placeholder="Amount" min="1" required>
              </div>
              <div class="col-md-3">
                  <button type="submit" class="btn btn-primary">Place Bet</button>
              </div>
          </form>

          {% if e.bets %}
          <div class="mt-3">
              <h6>📋 Current Bets:</h6>
              <table class="table table-sm table-bordered">
                  <thead>
                      <tr><th>Player</th><th>Outcome</th><th>Amount</th></tr>
                  </thead>
                  <tbody>
                      {% for bet in e.bets %}
                      <tr>
                          <td>
                              {{ bet.username }}
                              {% if bet.is_admin %}
                                  <span class="badge bg-danger">Admin</span>
                              {% endif %}
                          </td>
                          <td>{{ bet.outcome_name }}</td>
                          <td>{{ bet.amount }}</td>
                      </tr>
                      {% endfor %}
                  </tbody>
              </table>
          </div>
          {% else %}
          <p class="text-muted mt-2">No bets placed yet for this event.</p>
          {% endif %}
        </div>
      </div>
    {% endfor %}
{% else %}
<p>No active events</p>
{% endif %}

<!-- Pending Submissions -->
<h2 class="mt-4">⏳ Pending Submissions</h2>
{% if pending_events_data %}
    {% for e in pending_events_data %}
      <div class="card mb-3 border-warning">
        <div class="card-body">
          <h5>
            {{ e.event.title }}
            <span class="badge bg-warning text-dark">💡 Suggested{% if e.event.suggested_by %} by {{ e.event.suggested_by }}{% endif %}</span>
          </h5>
          <ul>
              {% for o in e.outcomes %}
                  <li>{{ o.outcome_name }} @ {{ o.odds }}</li>
              {% endfor %}
          </ul>
          <p class="text-muted fst-italic">Awaiting admin approval — bets not yet open.</p>
        </div>
      </div>
    {% endfor %}
{% else %}
<p>No pending submissions</p>
{% endif %}

{% endblock %}